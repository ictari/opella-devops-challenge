# Terraform Azure Infrastructure

> _Generated by AI 02/04/2026

This repository provisions Azure infrastructure using Terraform with reusable modules and GitHub Actions CI/CD support.

---

## ✨ Features

- Reusable VNET Terraform module
- Multiple environments (`dev`, `prod`, etc.) via `.tfvars` and GitHub workflow inputs
- Resources deployed:
  - Virtual Network (VNET) with multiple subnets
  - Azure Storage Account
  - Azure App Service and App Service Plan
  - Two Azure Linux Virtual Machines with subnet separation
- SSH public key support with local file or GitHub secret
- Optional `terraform destroy` step via `clean` input
- CI/CD using GitHub Actions

---

## 📁 Project Structure

```text
infra/
├── main.tf
├── variables.tf
├── outputs.tf
├── configs/
│   ├── dev.tfvars
│   └── backend_dev.tfvars
├── modules/
│   └── vnet/
│       ├── main.tf
│       ├── variables.tf
│       └── outputs.tf
.github/
└── workflows/
    └── terraform.yml
```

---

## 🚀 Getting Started

### Requirements
- Terraform CLI >= 1.5.7
- Azure CLI or Service Principal
- SSH key pair for Linux VMs

### Local Setup Example

```bash
cd infra
terraform init -backend-config=configs/backend_dev.tfvars
terraform plan -var-file=configs/dev.tfvars
terraform apply -var-file=configs/dev.tfvars
```

You can set `ssh_pub_key` in your `dev.tfvars` as:
```hcl
ssh_pub_key = file("/Users/you/.ssh/id_rsa.pub")
```

Or directly include the key (for testing only):
```hcl
ssh_pub_key = "ssh-rsa AAAA..."
```

---

## 🚧 GitHub Actions Workflow

### Workflow Inputs (Manual Trigger)
- `environment`: which environment to deploy (e.g. `dev`)
- `apply`: `true` to apply, `false` to plan only
- `clean`: `true` to destroy resources first

### Required GitHub Secrets
| Name                 | Purpose                    |
|----------------------|----------------------------|
| `ARM_CLIENT_ID`      | Azure SPN Client ID        |
| `ARM_CLIENT_SECRET`  | Azure SPN Secret           |
| `ARM_SUBSCRIPTION_ID`| Azure Subscription ID      |
| `ARM_TENANT_ID`      | Azure Tenant ID            |
| `SSH_PUB_KEY`        | SSH Public Key content     |

---

## 📚 Module: VNET

Reusable module to deploy an Azure VNET and networked VMs.

### Inputs
| Variable        | Description                        | Type          | Required |
|------------------|------------------------------------|---------------|----------|
| `vnet_name`      | Name of the VNET                  | `string`      | Yes      |
| `address_space`  | List of CIDR blocks               | `list(string)`| Yes      |
| `subnets`        | List of subnet objects            | `list(object)`| Yes      |
| `location`       | Azure region                      | `string`      | Yes      |
| `rg_name`        | Resource group                    | `string`      | Yes      |
| `prefix`         | Resource prefix                   | `string`      | Yes      |
| `tags`           | Tags for resources                | `map(string)` | No       |
| `ssh_pub_key`    | Public SSH key for VMs            | `string`      | Yes      |

### Outputs
| Name         | Description                |
|--------------|----------------------------|
| `vnet_id`    | ID of the created VNET     |
| `subnet_ids` | Map of subnet name to IDs  |

---

## 📜 Notes
- Never commit your actual public key inline in tracked `.tfvars` files
- Use GitHub secrets in CI
- Git pre-commit hook can block unsafe key check-ins using a comment marker like:
  ```hcl
  #local use - Do not check in with this
  ssh_pub_key = "..."
  ```

---

## ✅ To Do / Enhancements
- Add NSGs per subnet
- Output public IPs (if any)
- Add diagnostics/logging/monitoring resources

---

## 💚 License
MIT License

